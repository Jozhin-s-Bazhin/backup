# Colors
RED='\033[0;31m'
NC='\033[0m'

echo -e "$RED"
echo -e "Started system rebuild"

# Copy changes
echo -e "Copying changes... $NC"
cp /etc/nixos/configuration.nix ~/backup/configuration.nix 
echo -e "$RED"

# Commit and push changes
echo -e "Committing..."
echo -e "$NC"

git -C ~/backup/ add -A > /dev/null
git -C ~/backup/ commit -m "[ $(date) ] nixos-rebuild switch" 
git -C ~/backup/ push > /dev/null

# Rebuild system
echo -e "$RED"
echo -e "Starting nixos-rebuild switch ..."
echo -e "$NC"

sudo nixos-rebuild switch

echo -e "$RED"
echo -e "Finished${NC}"
