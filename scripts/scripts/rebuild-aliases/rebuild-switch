# Colors
RED='\033[0;34m'  # It's blue
NC='\033[0m'

echo -e "$RED"
echo -e "Started system rebuild"

# Copy changes
echo -e "Copying changes... $NC"
cp /etc/nixos/configuration.nix ~/backup/configuration.nix 
cp -r ~/.config/home-manager/ ~/backup/home-manager/

# Commit and push changes
echo -e "${RED}Committing..."
echo -e "$NC"

date=$(date)

git -C ~/backup/ add -A > /dev/null
git -C ~/backup/ commit -m "[ $date ] nixos-rebuild switch" 
git -C ~/backup/ push -q

# Rebuild system
echo -e "$RED"
echo -e "Starting nixos-rebuild switch ..."
echo -e "$NC"

sudo nixos-rebuild switch | tee ~/backup/logs/"[ $date ]-log"

echo -e "$RED"
echo -e "Finished${NC}"
